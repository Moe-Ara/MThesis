{"prompt": "You are an expert Wazuh detection engineer.\n\nDetection goal: Catch when PowerShell spawns a script/executable child (bat/cmd/ps1/exe/dll) instead of benign Explorer launches.\n\nSample log event:\n\ntimestamp: 2025-11-30T18:58:36.730+0000\nrule: {\"level\": 12, \"description\": \"Sysmon - Suspicious Process - explorer.exe\", \"id\": \"61640\", \"mitre\": {\"id\": [\"T1055\"], \"tactic\": [\"Defense Evasion\", \"Privilege Escalation\"], \"technique\": [\"Process Injection\"]}, \"firedtimes\": 1, \"mail\": true, \"groups\": [\"windows\", \"sysmon\", \"sysmon_process-anomalies\"], \"pci_dss\": [\"10.6.1\", \"11.4\"], \"gdpr\": [\"IV_35.7.d\"], \"hipaa\": [\"164.312.b\"], \"nist_800_53\": [\"AU.6\", \"SI.4\"], \"tsc\": [\"CC7.2\", \"CC7.3\", \"CC6.1\", \"CC6.8\"]}\nagent: {\"id\": \"002\", \"name\": \"Windows\", \"ip\": \"192.168.178.110\"}\nlocation: EventChannel\nfull_log: {\"win\":{\"system\":{\"providerName\":\"Microsoft-Windows-Sysmon\",\"providerGuid\":\"{5770385f-c22a-43e0-bf4c-06f5698ffbd9}\",\"eventID\":\"1\",\"version\":\"5\",\"level\":\"4\",\"task\":\"1\",\"opcode\":\"0\",\"keywords\":\"0x8000000000000000\",\"systemTime\":\"2025-11-30T18:58:33.1219819Z\",\"eventRecordID\":\"36448\",\"processID\":\"3516\",\"threadID\":\"4736\",\"channel\":\"Microsoft-Windows-Sysmon/Operational\",\"computer\":\"Windows\",\"severityValue\":\"INFORMATION\",\"message\":\"\\\"Process Create:\\r\\nRuleName: -\\r\\nUtcTime: 2025-11-30 18:58:33.113\\r\\nProcessGuid: {de4d1a0f-93d9-692c-6502-000000000d00}\\r\\nProcessId: 5920\\r\\nImage: C:\\\\Windows\\\\explorer.exe\\r\\nFileVersion: 10.0.26100.7019 (WinBuild.160101.0800)\\r\\nDescription: Windows Explorer\\r\\nProduct: Microsoft速 Windows速 Operating System\\r\\nCompany: Microsoft Corporation\\r\\nOriginalFileName: EXPLORER.EXE\\r\\nCommandLine: \\\"C:\\\\WINDOWS\\\\explorer.exe\\\" .\\r\\nCurrentDirectory: C:\\\\Users\\\\vboxuser\\\\\\r\\nUser: WINDOWS\\\\vboxuser\\r\\nLogonGuid: {de4d1a0f-8e7f-692c-71bf-020000000000}\\r\\nLogonId: 0x2BF71\\r\\nTerminalSessionId: 1\\r\\nIntegrityLevel: High\\r\\nHashes: MD5=6B488D6D4D0EBA6B5F01D9CCAA16F67C,SHA256=3D598FE7C698DAD75EC0A4ACD68E512A28505B24F1C81CB0B0E0779D4D2DED1C,IMPHASH=413B9EF19DA4F820A34BBE5ABADC1783\\r\\nParentProcessGuid: {de4d1a0f-9323-692c-3c02-000000000d00}\\r\\nParentProcessId: 10116\\r\\nParentImage: C:\\\\Windows\\\\System32\\\\WindowsPowerShell\\\\v1.0\\\\powershell.exe\\r\\nParentCommandLine: C:\\\\WINDOWS\\\\System32\\\\WindowsPowerShell\\\\v1.0\\\\powershell.exe\\r\\nParentUser: WINDOWS\\\\vboxuser\\\"\"},\"eventdata\":{\"utcTime\":\"2025-11-30 18:58:33.113\",\"processGuid\":\"{de4d1a0f-93d9-692c-6502-000000000d00}\",\"processId\":\"5920\",\"image\":\"C:\\\\\\\\Windows\\\\\\\\explorer.exe\",\"fileVersion\":\"10.0.26100.7019 (WinBuild.160101.0800)\",\"description\":\"Windows Explorer\",\"product\":\"Microsoft速 Windows速 Operating System\",\"company\":\"Microsoft Corporation\",\"originalFileName\":\"EXPLORER.EXE\",\"commandLine\":\"\\\\\\\"C:\\\\\\\\WINDOWS\\\\\\\\explorer.exe\\\\\\\" .\",\"currentDirectory\":\"C:\\\\\\\\Users\\\\\\\\vboxuser\\\\\\\\\",\"user\":\"WINDOWS\\\\\\\\vboxuser\",\"logonGuid\":\"{de4d1a0f-8e7f-692c-71bf-020000000000}\",\"logonId\":\"0x2bf71\",\"terminalSessionId\":\"1\",\"integrityLevel\":\"High\",\"hashes\":\"MD5=6B488D6D4D0EBA6B5F01D9CCAA16F67C,SHA256=3D598FE7C698DAD75EC0A4ACD68E512A28505B24F1C81CB0B0E0779D4D2DED1C,IMPHASH=413B9EF19DA4F820A34BBE5ABADC1783\",\"parentProcessGuid\":\"{de4d1a0f-9323-692c-3c02-000000000d00}\",\"parentProcessId\":\"10116\",\"parentImage\":\"C:\\\\\\\\Windows\\\\\\\\System32\\\\\\\\WindowsPowerShell\\\\\\\\v1.0\\\\\\\\powershell.exe\",\"parentCommandLine\":\"C:\\\\\\\\WINDOWS\\\\\\\\System32\\\\\\\\WindowsPowerShell\\\\\\\\v1.0\\\\\\\\powershell.exe\",\"parentUser\":\"WINDOWS\\\\\\\\vboxuser\"}}}\n\nCurrent description: {\"level\": 12, \"description\": \"Sysmon - Suspicious Process - explorer.exe\", \"id\": \"61640\", \"mitre\": {\"id\": [\"T1055\"], \"tactic\": [\"Defense Evasion\", \"Privilege Escalation\"], \"technique\": [\"Process Injection\"]}, \"firedtimes\": 1, \"mail\": true, \"groups\": [\"windows\", \"sysmon\", \"sysmon_process-anomalies\"], \"pci_dss\": [\"10.6.1\", \"11.4\"], \"gdpr\": [\"IV_35.7.d\"], \"hipaa\": [\"164.312.b\"], \"nist_800_53\": [\"AU.6\", \"SI.4\"], \"tsc\": [\"CC7.2\", \"CC7.3\", \"CC6.1\", \"CC6.8\"]}\n\nProduce a precise Wazuh custom rule (XML) that would detect this behavior.", "completion": "<group name=\"custom_sysmon_rules,process_injection,lab\"><rule id=\"100601\" level=\"12\"><if_group>sysmon</if_group><field name=\"win.eventdata.parentImage\">*\\\\powershell.exe</field><match>*.{bat,cmd,ps1,exe,dll}</match><description>Lab: PowerShell launched a suspicious script/executable child</description><group>sysmon,windows,lab_suspicious_child,</group></rule></group>"}
{"prompt": "You are an expert Wazuh detection engineer.\n\nDetection goal: Alert when a Windows user logs in from multiple remote locations rapidly or when successful logons are preceded by frequent failures.\n\nSample log event:\n\ntimestamp: 2025-11-30T18:59:35.779+0000\nrule: {\"level\": 3, \"description\": \"Windows logon success.\", \"id\": \"60106\", \"mitre\": {\"id\": [\"T1078\"], \"tactic\": [\"Defense Evasion\", \"Persistence\", \"Privilege Escalation\", \"Initial Access\"], \"technique\": [\"Valid Accounts\"]}, \"firedtimes\": 50, \"mail\": false, \"groups\": [\"windows\", \"windows_security\", \"authentication_success\"], \"gdpr\": [\"IV_32.2\"], \"gpg13\": [\"7.1\", \"7.2\"], \"hipaa\": [\"164.312.b\"], \"nist_800_53\": [\"AC.7\", \"AU.14\"], \"pci_dss\": [\"10.2.5\"], \"tsc\": [\"CC6.8\", \"CC7.2\", \"CC7.3\"]}\nagent: {\"id\": \"002\", \"name\": \"Windows\", \"ip\": \"192.168.178.110\"}\nlocation: EventChannel\n\nCurrent description: {\"level\": 3, \"description\": \"Windows logon success.\", \"id\": \"60106\", \"mitre\": {\"id\": [\"T1078\"], \"tactic\": [\"Defense Evasion\", \"Persistence\", \"Privilege Escalation\", \"Initial Access\"], \"technique\": [\"Valid Accounts\"]}, \"firedtimes\": 50, \"mail\": false, \"groups\": [\"windows\", \"windows_security\", \"authentication_success\"], \"gdpr\": [\"IV_32.2\"], \"gpg13\": [\"7.1\", \"7.2\"], \"hipaa\": [\"164.312.b\"], \"nist_800_53\": [\"AC.7\", \"AU.14\"], \"pci_dss\": [\"10.2.5\"], \"tsc\": [\"CC6.8\", \"CC7.2\", \"CC7.3\"]}\n\nProduce a precise Wazuh custom rule (XML) that would detect this behavior.", "completion": "<group name=\"custom_windows_rules,authentication\"><rule id=\"100602\" level=\"12\"><if_group>windows_security</if_group><frequency>5</frequency><timeframe>3600</timeframe><description>Lab: Frequent/failing logons indicating possible credential abuse</description><group>authentication_success,lab_risky_logon,</group></rule></group>"}
{"prompt": "You are an expert Wazuh detection engineer.\n\nDetection goal: Flag when sudo to root runs operations like service restarts that could indicate lateral movement or post-exploitation activity.\n\nSample log event:\n\ntimestamp: 2025-11-30T19:02:56.109+0000\nrule: {\"level\": 3, \"description\": \"Successful sudo to ROOT executed.\", \"id\": \"5402\", \"mitre\": {\"id\": [\"T1548.003\"], \"tactic\": [\"Privilege Escalation\", \"Defense Evasion\"], \"technique\": [\"Sudo and Sudo Caching\"]}, \"firedtimes\": 2, \"mail\": false, \"groups\": [\"syslog\", \"sudo\"], \"pci_dss\": [\"10.2.5\", \"10.2.2\"], \"gpg13\": [\"7.6\", \"7.8\", \"7.13\"], \"gdpr\": [\"IV_32.2\"], \"hipaa\": [\"164.312.b\"], \"nist_800_53\": [\"AU.14\", \"AC.7\", \"AC.6\"], \"tsc\": [\"CC6.8\", \"CC7.2\", \"CC7.3\"]}\nagent: {\"id\": \"000\", \"name\": \"balanced-coonhound\"}\nlocation: /var/log/auth.log\nfull_log: Nov 30 19:02:55 balanced-coonhound sudo:   ubuntu : TTY=pts/0 ; PWD=/home/ubuntu ; USER=root ; COMMAND=/usr/bin/systemctl restart xrdp\n\nCurrent description: {\"level\": 3, \"description\": \"Successful sudo to ROOT executed.\", \"id\": \"5402\", \"mitre\": {\"id\": [\"T1548.003\"], \"tactic\": [\"Privilege Escalation\", \"Defense Evasion\"], \"technique\": [\"Sudo and Sudo Caching\"]}, \"firedtimes\": 2, \"mail\": false, \"groups\": [\"syslog\", \"sudo\"], \"pci_dss\": [\"10.2.5\", \"10.2.2\"], \"gpg13\": [\"7.6\", \"7.8\", \"7.13\"], \"gdpr\": [\"IV_32.2\"], \"hipaa\": [\"164.312.b\"], \"nist_800_53\": [\"AU.14\", \"AC.7\", \"AC.6\"], \"tsc\": [\"CC6.8\", \"CC7.2\", \"CC7.3\"]}\n\nProduce a precise Wazuh custom rule (XML) that would detect this behavior.", "completion": "<group name=\"local,sudo,privilege_escalation\"><rule id=\"100603\" level=\"12\"><if_group>sudo</if_group><match>COMMAND=.*systemctl restart</match><description>Lab: root invoked via sudo to restart services after compromise</description><group>sudo,lab_root_use,</group></rule></group>"}
{"prompt": "You are an expert Wazuh detection engineer.\n\nDetection goal: Detect installs of developer tools (e.g., Neovim) that occur without change control, especially when they follow suspicious activity.\n\nSample log event:\n\ntimestamp: 2025-11-30T18:59:02.489+0000\nrule: {\"level\": 3, \"description\": \"Application installed Product: Neovim -- Installation completed successfully..\", \"id\": \"60612\", \"firedtimes\": 3, \"mail\": false, \"groups\": [\"windows\", \"windows_application\"]}\nagent: {\"id\": \"002\", \"name\": \"Windows\", \"ip\": \"192.168.178.110\"}\nlocation: EventChannel\n\nCurrent description: {\"level\": 3, \"description\": \"Application installed Product: Neovim -- Installation completed successfully..\", \"id\": \"60612\", \"firedtimes\": 3, \"mail\": false, \"groups\": [\"windows\", \"windows_application\"]}\n\nProduce a precise Wazuh custom rule (XML) that would detect this behavior.", "completion": "<group name=\"local,software_install,windows\"><rule id=\"100604\" level=\"8\"><if_group>windows_application</if_group><match>Neovim</match><description>Lab: Unapproved Neovim install detected</description><group>software_install,lab_neovim,</group></rule></group>"}
{"prompt": "You are an expert Wazuh detection engineer.\n\nDetection goal: Alert when CIS check reports Remote Shell Access set to Enabled instead of Disabled.\n\nSample log event:\n\ntimestamp: 2025-12-01T20:10:38.935+0000\nrule: {\"level\": 7, \"description\": \"CIS Microsoft Windows 11 Enterprise Benchmark v1.0.0: Ensure 'Allow Remote Shell Access' is set to 'Disabled'.\", \"id\": \"19007\", \"firedtimes\": 262, \"mail\": false, \"groups\": [\"sca\"], \"gdpr\": [\"IV_35.7.d\"], \"pci_dss\": [\"2.2\", \"4.1\"], \"nist_800_53\": [\"CM.1\", \"SC.8\"], \"tsc\": [\"CC7.1\", \"CC7.2\", \"CC6.1\", \"CC6.7\", \"CC7.2\"], \"cis\": [\"18.9.103.1\"], \"hipaa\": [\"164.312.a.2.IV\", \"164.312.e.1\", \"164.312.e.2.I\", \"164.312.e.2.II\"]}\nagent: {\"id\": \"003\", \"name\": \"WindowsDaily\", \"ip\": \"192.168.178.94\"}\nlocation: sca\nfull_log: {\"type\":\"check\",\"id\":1698794050,\"policy\":\"CIS Microsoft Windows 11 Enterprise Benchmark v1.0.0\",\"policy_id\":\"cis_win11_enterprise_21H2\",\"check\":{\"id\":26384,\"title\":\"Ensure 'Allow Remote Shell Access' is set to 'Disabled'.\",\"description\":\"This policy setting allows you to manage configuration of remote access to all supported shells to execute scripts and commands. The recommended state for this setting is: Disabled. Note: The GPME help text for this setting is incorrectly worded, implying that configuring it to Enabled will reject new Remote Shell connections, and setting it to Disabled will allow Remote Shell connections. The opposite is true (and is consistent with the title of the setting). This is a wording mistake by Microsoft in the Administrative Template.\",\"rationale\":\"Any feature is a potential avenue of attack, those that enable inbound network connections are particularly risky. Only enable the use of the Windows Remote Shell on trusted networks and when feasible employ additional controls such as IPsec.\",\"remediation\":\"To establish the recommended configuration via GP, set the following UI path to Disabled: Computer Configuration\\\\Administrative Templates\\\\Windows Components\\\\Windows Remote Shell\\\\Allow Remote Shell Access. Note: This Group Policy path is provided by the Group Policy template WindowsRemoteShell.admx/adml that is included with all versions of the Microsoft Windows Administrative Templates.\",\"compliance\":{\"cis\":\"18.9.103.1\",\"pci_dss\":\"4.1\",\"hipaa\":\"164.312.a.2.IV,164.312.e.1,164.312.e.2.I,164.312.e.2.II\",\"nist_800_53\":\"SC.8\",\"tsc\":\"CC6.1,CC6.7,CC7.2\"},\"rules\":[\"r:HKEY_LOCAL_MACHINE\\\\SOFTWARE\\\\Policies\\\\Microsoft\\\\Windows\\\\WinRM\\\\Service\\\\WinRS\",\"r:HKEY_LOCAL_MACHINE\\\\SOFTWARE\\\\Policies\\\\Microsoft\\\\Windows\\\\WinRM\\\\Service\\\\WinRS -> AllowRemoteShellAccess\",\"r:HKEY_LOCAL_MACHINE\\\\SOFTWARE\\\\Policies\\\\Microsoft\\\\Windows\\\\WinRM\\\\Service\\\\WinRS -> AllowRemoteShellAccess -> 0\"],\"condition\":\"all\",\"registry\":\"HKEY_LOCAL_MACHINE\\\\SOFTWARE\\\\Policies\\\\Microsoft\\\\Windows\\\\WinRM\\\\Service\\\\WinRS\",\"result\":\"failed\"}}\n\nCurrent description: {\"level\": 7, \"description\": \"CIS Microsoft Windows 11 Enterprise Benchmark v1.0.0: Ensure 'Allow Remote Shell Access' is set to 'Disabled'.\", \"id\": \"19007\", \"firedtimes\": 262, \"mail\": false, \"groups\": [\"sca\"], \"gdpr\": [\"IV_35.7.d\"], \"pci_dss\": [\"2.2\", \"4.1\"], \"nist_800_53\": [\"CM.1\", \"SC.8\"], \"tsc\": [\"CC7.1\", \"CC7.2\", \"CC6.1\", \"CC6.7\", \"CC7.2\"], \"cis\": [\"18.9.103.1\"], \"hipaa\": [\"164.312.a.2.IV\", \"164.312.e.1\", \"164.312.e.2.I\", \"164.312.e.2.II\"]}\n\nProduce a precise Wazuh custom rule (XML) that would detect this behavior.", "completion": "<group name=\"custom_windows_rules,compliance\"><rule id=\"100605\" level=\"10\"><if_group>sca</if_group><match>AllowRemoteShellAccess</match><description>Lab: Remote Shell Access should remain disabled per CIS guidance</description><group>sca,compliance</group></rule></group>"}
{"prompt": "You are an expert Wazuh detection engineer.\n\nDetection goal: Detect SSH successes from new or infrequent remote hosts that could signal persistent access beyond normal VPN endpoints.\n\nSample log event:\n\ntimestamp: 2025-11-30T20:57:15.512+0000\nrule: {\"level\": 3, \"description\": \"sshd: authentication success.\", \"id\": \"5715\", \"mitre\": {\"id\": [\"T1078\", \"T1021\"], \"tactic\": [\"Defense Evasion\", \"Persistence\", \"Privilege Escalation\", \"Initial Access\", \"Lateral Movement\"], \"technique\": [\"Valid Accounts\", \"Remote Services\"]}, \"firedtimes\": 1, \"mail\": false, \"groups\": [\"syslog\", \"sshd\", \"authentication_success\"], \"gdpr\": [\"IV_32.2\"], \"gpg13\": [\"7.1\", \"7.2\"], \"hipaa\": [\"164.312.b\"], \"nist_800_53\": [\"AU.14\", \"AC.7\"], \"pci_dss\": [\"10.2.5\"], \"tsc\": [\"CC6.8\", \"CC7.2\", \"CC7.3\"]}\nagent: {\"id\": \"000\", \"name\": \"balanced-coonhound\"}\nlocation: /var/log/auth.log\nfull_log: Nov 30 20:57:15 balanced-coonhound sshd[594455]: Accepted publickey for ubuntu from 10.0.2.2 port 60551 ssh2: RSA SHA256:QG/aUKOAhUgzQeGN/NdikY8eLx8tFyAKlllDlz7U98Y\n\nCurrent description: {\"level\": 3, \"description\": \"sshd: authentication success.\", \"id\": \"5715\", \"mitre\": {\"id\": [\"T1078\", \"T1021\"], \"tactic\": [\"Defense Evasion\", \"Persistence\", \"Privilege Escalation\", \"Initial Access\", \"Lateral Movement\"], \"technique\": [\"Valid Accounts\", \"Remote Services\"]}, \"firedtimes\": 1, \"mail\": false, \"groups\": [\"syslog\", \"sshd\", \"authentication_success\"], \"gdpr\": [\"IV_32.2\"], \"gpg13\": [\"7.1\", \"7.2\"], \"hipaa\": [\"164.312.b\"], \"nist_800_53\": [\"AU.14\", \"AC.7\"], \"pci_dss\": [\"10.2.5\"], \"tsc\": [\"CC6.8\", \"CC7.2\", \"CC7.3\"]}\n\nProduce a precise Wazuh custom rule (XML) that would detect this behavior.", "completion": "<group name=\"local,ssh,authentication\"><rule id=\"100606\" level=\"11\"><if_group>sshd</if_group><match>Accepted publickey</match><description>Lab: SSH auth success from unfamiliar remote source</description><group>ssh,lab_unusual_auth,</group></rule></group>"}
{"prompt": "You are an expert Wazuh detection engineer.\n\nDetection goal: Catch files dropped into directories commonly abused by malware (malicious payloads in suspicious folders).\n\nSample log event:\n\ntimestamp: 2025-11-30T18:59:33.133+0000\nrule: {\"level\": 15, \"description\": \"Executable file dropped in folder commonly used by malware\", \"id\": \"92213\", \"mitre\": {\"id\": [\"T1105\"], \"tactic\": [\"Command and Control\"], \"technique\": [\"Ingress Tool Transfer\"]}, \"firedtimes\": 5, \"mail\": true, \"groups\": [\"sysmon\", \"sysmon_eid11_detections\", \"windows\"]}\nagent: {\"id\": \"002\", \"name\": \"Windows\", \"ip\": \"192.168.178.110\"}\nlocation: EventChannel\n\nCurrent description: {\"level\": 15, \"description\": \"Executable file dropped in folder commonly used by malware\", \"id\": \"92213\", \"mitre\": {\"id\": [\"T1105\"], \"tactic\": [\"Command and Control\"], \"technique\": [\"Ingress Tool Transfer\"]}, \"firedtimes\": 5, \"mail\": true, \"groups\": [\"sysmon\", \"sysmon_eid11_detections\", \"windows\"]}\n\nProduce a precise Wazuh custom rule (XML) that would detect this behavior.", "completion": "<group name=\"custom_windows_rules,syscheck\"><rule id=\"100607\" level=\"13\"><if_group>syscheck</if_group><match>folder commonly used by malware</match><description>Lab: Executable dropped in high-risk directory</description><group>syscheck,lab_bad_drop,</group></rule></group>"}
{"prompt": "You are an expert Wazuh detection engineer.\n\nDetection goal: Flag rootcheck alerts showing Trojaned system utilities to distinguish malicious from benign rootcheck noise.\n\nSample log event:\n\ntimestamp: 2025-11-30T19:03:17.523+0000\nrule: {\"level\": 7, \"description\": \"Host-based anomaly detection event (rootcheck).\", \"id\": \"510\", \"firedtimes\": 1, \"mail\": false, \"groups\": [\"ossec\", \"rootcheck\"], \"pci_dss\": [\"10.6.1\"], \"gdpr\": [\"IV_35.7.d\"]}\nagent: {\"id\": \"000\", \"name\": \"balanced-coonhound\"}\nlocation: rootcheck\nfull_log: Trojaned version of file '/bin/diff' detected. Signature used: 'bash|^/bin/sh|file\\.h|proc\\.h|/dev/[^n]|^/bin/.*sh' (Generic).\n\nCurrent description: {\"level\": 7, \"description\": \"Host-based anomaly detection event (rootcheck).\", \"id\": \"510\", \"firedtimes\": 1, \"mail\": false, \"groups\": [\"ossec\", \"rootcheck\"], \"pci_dss\": [\"10.6.1\"], \"gdpr\": [\"IV_35.7.d\"]}\n\nProduce a precise Wazuh custom rule (XML) that would detect this behavior.", "completion": "<group name=\"custom_rules,rootcheck\"><rule id=\"100608\" level=\"11\"><if_group>rootcheck</if_group><match>Trojaned version of file '/bin/diff' detected</match><description>Lab: Rootcheck flagged trojaned /bin/diff</description><group>rootcheck,lab_trojan,</group></rule></group>"}
